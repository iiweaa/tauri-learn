# 第7课作业：系统托盘与菜单

## 作业信息

- **课程编号**：第7课
- **课程标题**：系统托盘与菜单
- **作业提交时间**：完成课程学习后
- **作业检查标准**：
  - 所有必做作业必须完成
  - 代码能够正常运行
  - 功能实现正确
  - 托盘和菜单功能正常
  - 代码已提交到Git

## 必做作业

### 任务1：配置系统托盘

**要求**：
1. 在 `Cargo.toml` 中启用 `tray-icon` 特性
2. 创建系统托盘图标和菜单
3. 配置窗口关闭行为为隐藏（而不是退出）
4. 托盘菜单至少包含：显示窗口、隐藏窗口、退出

**检查点**：
- [ ] `tray-icon` 特性已启用
- [ ] 系统托盘已创建
- [ ] 托盘菜单已配置
- [ ] 窗口关闭行为已设置为隐藏
- [ ] 项目能够正常编译和运行

**功能要求**：
- 托盘图标正常显示
- 托盘菜单可以正常打开
- 关闭窗口后应用仍在托盘中运行

### 任务2：实现托盘事件处理

**要求**：
1. 实现托盘左键点击事件：显示/隐藏主窗口
2. 实现托盘菜单项点击事件：
   - "显示窗口"：显示并聚焦主窗口
   - "隐藏窗口"：隐藏主窗口
   - "退出"：退出应用
3. 根据窗口状态动态更新菜单项标题

**检查点**：
- [ ] 左键点击可以切换窗口显示/隐藏
- [ ] 菜单项点击功能正常
- [ ] 菜单项标题能够动态更新
- [ ] 退出功能正常工作

**代码示例**：
```rust
.on_system_tray_event(|app, event| {
    match event {
        SystemTrayEvent::LeftClick { .. } => {
            // 切换窗口显示/隐藏
        }
        SystemTrayEvent::MenuItemClick { id, .. } => {
            match id.as_str() {
                "show" => {
                    // 显示窗口
                }
                "hide" => {
                    // 隐藏窗口
                }
                "quit" => {
                    // 退出应用
                }
                _ => {}
            }
        }
        _ => {}
    }
})
```

### 任务3：创建应用菜单栏

**要求**：
1. 创建应用菜单栏，至少包含以下菜单：
   - **文件菜单**：新建、打开、保存、另存为、退出
   - **编辑菜单**：撤销、重做、剪切、复制、粘贴
   - **视图菜单**：放大、缩小、重置缩放
   - **帮助菜单**：关于
2. 为常用菜单项添加快捷键：
   - 新建：Ctrl+N (Cmd+N on macOS)
   - 打开：Ctrl+O (Cmd+O on macOS)
   - 保存：Ctrl+S (Cmd+S on macOS)
   - 退出：Ctrl+Q (Cmd+Q on macOS)

**检查点**：
- [ ] 菜单栏已创建
- [ ] 所有菜单项正常显示
- [ ] 快捷键已配置
- [ ] 菜单项点击事件已处理

**功能要求**：
- 菜单结构清晰合理
- 使用原生菜单项（如撤销、重做、复制等）获得平台标准行为
- 快捷键在不同平台正确工作

### 任务4：实现菜单事件处理

**要求**：
1. 为所有菜单项实现点击事件处理
2. 文件菜单项：
   - 新建：显示提示信息（可以使用对话框）
   - 打开：显示提示信息
   - 保存：显示提示信息
   - 另存为：显示提示信息
   - 退出：退出应用
3. 视图菜单项：
   - 放大、缩小、重置缩放：显示提示信息
4. 帮助菜单项：
   - 关于：显示应用信息对话框

**检查点**：
- [ ] 所有菜单项都有事件处理
- [ ] 菜单项点击后执行相应操作
- [ ] 退出功能正常工作
- [ ] 对话框显示正常

**代码示例**：
```rust
.on_menu_event(|event| {
    match event.menu_item_id() {
        "new" => {
            println!("新建文件");
            // 可以调用对话框显示提示
        }
        "open" => {
            println!("打开文件");
        }
        "save" => {
            println!("保存文件");
        }
        "exit" => {
            std::process::exit(0);
        }
        "about" => {
            println!("关于应用");
            // 可以调用对话框显示应用信息
        }
        _ => {}
    }
})
```

### 任务5：测试托盘和菜单功能

**要求**：
1. 测试托盘图标显示
2. 测试托盘菜单功能
3. 测试窗口关闭后应用仍在托盘运行
4. 测试菜单栏功能
5. 测试快捷键功能
6. 测试在不同平台上的表现（如果可能）

**检查点**：
- [ ] 托盘图标正常显示
- [ ] 托盘菜单功能正常
- [ ] 窗口关闭后应用继续运行
- [ ] 菜单栏功能正常
- [ ] 快捷键正常工作
- [ ] 所有功能在不同平台表现正常

**测试清单**：
- [ ] 托盘左键点击切换窗口
- [ ] 托盘菜单项点击功能
- [ ] 窗口关闭后应用仍在托盘
- [ ] 菜单栏所有菜单项可点击
- [ ] 快捷键触发菜单功能
- [ ] 退出功能正常

## 选做作业

### 任务6：托盘菜单动态更新

**要求**：
1. 根据应用状态动态更新托盘菜单项
2. 例如：根据窗口是否可见，更新"显示窗口"/"隐藏窗口"菜单项标题
3. 可以添加/移除菜单项
4. 可以启用/禁用菜单项

**实现建议**：
- 使用 `tray_handle().get_item()` 获取菜单项
- 使用 `set_title()` 更新标题
- 使用 `set_enabled()` 启用/禁用菜单项

**检查点**：
- [ ] 菜单项标题能够动态更新
- [ ] 菜单项能够动态启用/禁用
- [ ] 更新逻辑正确

### 任务7：菜单项状态管理

**要求**：
1. 实现菜单项的选中状态（checkbox）
2. 实现菜单项的分组
3. 根据应用状态更新菜单项状态
4. 例如：视图菜单中的缩放选项可以显示当前缩放级别

**实现建议**：
- 使用 `CustomMenuItem::new().checked()` 创建带选中状态的菜单项
- 使用 `set_selected()` 更新选中状态
- 使用分隔线分组相关菜单项

**检查点**：
- [ ] 菜单项可以显示选中状态
- [ ] 菜单项状态能够动态更新
- [ ] 菜单项分组清晰

### 任务8：托盘图标动画或状态指示

**要求**：
1. 根据应用状态改变托盘图标
2. 例如：应用有未读消息时显示不同的图标
3. 或者使用工具提示（tooltip）显示状态信息
4. 可以显示通知数量等

**实现建议**：
- 使用 `SystemTray::new().with_tooltip()` 设置工具提示
- 使用 `SystemTray::new().with_icon()` 动态更换图标
- 监听应用状态变化，更新托盘图标

**检查点**：
- [ ] 托盘图标能够动态更换
- [ ] 工具提示能够显示状态信息
- [ ] 状态更新及时准确

### 任务9：菜单与前端集成

**要求**：
1. 创建Rust命令，允许前端控制菜单状态
2. 例如：前端可以启用/禁用菜单项、更新菜单项标题
3. 前端可以监听菜单项点击事件（通过事件系统）
4. 实现菜单项与前端功能的联动

**实现建议**：
- 创建 `update_menu_item` 命令
- 使用 `app.emit()` 发送事件到前端
- 前端使用 `listen()` 监听事件

**检查点**：
- [ ] 前端可以控制菜单状态
- [ ] 菜单事件可以传递到前端
- [ ] 菜单与前端功能联动正常

### 任务10：完整的应用菜单系统

**要求**：
1. 创建一个完整的、实用的应用菜单系统
2. 菜单项与实际功能关联（如文件操作、编辑操作等）
3. 实现菜单项的权限控制（某些菜单项需要特定条件才能使用）
4. 实现菜单项的上下文相关显示（根据当前状态显示不同菜单）

**实现建议**：
- 结合之前学过的文件系统、对话框等功能
- 实现真实的文件操作菜单
- 实现编辑功能的菜单
- 根据应用状态动态显示菜单

**检查点**：
- [ ] 菜单系统完整实用
- [ ] 菜单项与实际功能关联
- [ ] 权限控制正常工作
- [ ] 上下文菜单显示正确

## 作业提交

### 提交要求

1. **代码提交**：
   - 所有代码必须提交到Git仓库
   - 提交信息清晰明确
   - 代码格式规范，有适当注释

2. **功能验证**：
   - 所有必做作业功能正常
   - 选做作业（如果完成）功能正常
   - 无编译错误和运行时错误

3. **测试报告**：
   - 记录测试过程
   - 记录遇到的问题和解决方法
   - 记录在不同平台上的表现（如果可能）

### 提交步骤

1. **完成代码**：
   ```bash
   cd my-first-tauri-app
   # 完成所有作业任务
   ```

2. **测试功能**：
   ```bash
   npm run tauri dev
   # 测试所有功能
   ```

3. **提交代码**：
   ```bash
   git add .
   git commit -m "完成第7课作业：系统托盘与菜单"
   git push origin master
   ```

4. **告知老师**：
   - 明确说明完成了哪些必做作业
   - 说明完成了哪些选做作业（如果有）
   - 说明遇到的问题和解决方法

## 作业检查

### 检查流程

1. **代码审查**：
   - 检查代码质量和规范性
   - 检查功能实现是否正确
   - 检查错误处理是否完善

2. **功能测试**：
   - 测试托盘功能
   - 测试菜单功能
   - 测试快捷键功能
   - 测试窗口关闭行为

3. **平台兼容性**：
   - 检查在不同平台上的表现
   - 检查平台特定功能是否正常

### 检查标准

- ✅ **必做作业**：所有5个任务必须完成并通过测试
- ✅ **代码质量**：代码规范、注释清晰、错误处理完善
- ✅ **功能正确**：所有功能正常工作，无bug
- ✅ **用户体验**：托盘和菜单使用流畅，交互友好

### 通过标准

只有满足以下所有条件，作业才能通过：

1. ✅ 所有必做作业已完成
2. ✅ 代码能够正常编译和运行
3. ✅ 所有功能正常工作
4. ✅ 代码已提交到Git
5. ✅ 无严重bug或错误

### 改进建议

如果作业未通过，老师会提供改进建议：

- **功能缺失**：指出缺少的功能
- **代码问题**：指出代码中的问题
- **最佳实践**：提供改进建议
- **学习资源**：推荐相关学习资源

## 学习资源

### 官方文档

- [Tauri System Tray](https://tauri.app/v1/guides/features/system-tray)
- [Tauri Menu](https://tauri.app/v1/api/js/menu)
- [Tauri Menu Rust API](https://docs.rs/tauri/latest/tauri/menu/index.html)

### 相关课程

- 第4课：窗口管理与自定义
- 第6课：系统通知与对话框

### 示例代码

- 讲义中的完整代码示例
- Tauri官方示例项目

---

**祝学习顺利！完成作业后记得提交代码并告知老师。** 🚀

